# Converting Holodeck Scenes for SceneEval

This guide explains how to convert scenes generated by Holodeck into a format compatible with SceneEval.

This guide assumes you have already set up SceneEval by following the instructions in the main [README.md](../../README.md).

## Prerequisites

### 1. Clone the Holodeck Repository
```bash
git clone https://github.com/allenai/Holodeck
```

### 2. Follow Holodeck's Setup Instructions
Follow the `README.md` in the Holodeck repository to set up the environment and download the necessary assets.

Specifically, follow these sections in their `README.md`:
- [Installation](https://github.com/allenai/Holodeck?tab=readme-ov-file#installation) - Set up the Python environment and install dependencies.
- [Data](https://github.com/allenai/Holodeck?tab=readme-ov-file#data) - Download the necessary 3D assets for Holodeck.
- [Load the scene in Unity](https://github.com/allenai/Holodeck?tab=readme-ov-file#load-the-scene-in-unity) - Set up Unity (step 1 to 3). The AI2-THOR repo should be at the root of the Holodeck directory.

### 3. Generate Scenes with Holodeck
Follow the instructions in the Holodeck `README.md` to generate scenes.

By default, generated scenes are saved in the `Holodeck/data/scenes/` directory. The following instructions assume this default path.

#### **NOTE**
Holodeck retrieves assets from two sources: `objathor`, which you downloaded in step 2, and the `AI2-THOR` asset set, which is bundled with the `AI2-THOR` Unity environment.

**SceneEval does not currently support `AI2-THOR` assets.**

You have two options to handle this:
1. **Do Nothing**: Our conversion script will skip objects from the `AI2-THOR` set. This may result in incomplete scenes.
2. **Patch Holodeck**: We provide a patched retriever script that prevents Holodeck from using `AI2-THOR` assets. To apply the patch, overwrite Holodeck's `objaverse_retriever.py` with our version.
    ```bash
    cp ./objaverse_retriever.py <YOUR_PATH>/Holodeck/ai2holodeck/generation/objaverse_retriever.py
    ```

We recommend **option 2** to ensure complete scenes.



## Setup Conversion Script
### 1. Place the Unity Script
Holodeck's output JSON files must be processed in AI2-THOR to get the final object transforms. Our conversion process uses a Unity script to automate this step.

Copy `PythonUnityBridge.cs` from this directory to AI2-THOR's `Assets/Editor/` folder.
```bash
cp ./PythonUnityBridge.cs <YOUR_PATH>/Holodeck/ai2thor/unity/Assets/Editor/PythonUnityBridge.cs
```

### 2. Place the Conversion Script
Copy `convert_SceneEval.py` from this directory into the root of the Holodeck repository.
```bash
cp ./convert_SceneEval.py <YOUR_PATH>/Holodeck/convert_SceneEval.py
```
This script controls Unity to get the final object transforms and converts Holodeck scenes into the scene state format SceneEval uses.


## Running the Conversion

### 1. Start Unity
Open the AI2-THOR project in Unity before running the conversion script.
- Add the AI2-THOR project from `Holodeck/ai2thor/unity/` to your Unity Hub.
- Open the project in the Unity Editor.

### 2. Open the `Procedure.unity` Scene
In the Unity Editor, open the `Procedure.unity` scene located in `ai2thor/unity/Assets/Scenes/Procedural/Procedural.unity`.

### 3. Run the Conversion Script
With Unity running and the `Procedure.unity` scene open, execute the conversion script from the root of the Holodeck repository:
```bash
python convert_SceneEval.py
```
By default, this script reads scenes from `Holodeck/data/scenes/` and saves the converted scenes to `Holodeck/data/converted_scenes/`.
